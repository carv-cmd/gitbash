# SSH for GitHub

## OpenSSH
Please read the [*OpenSSH documentation*](https://www.openssh.com/) if you plan to use it extensively.

A properly configured client and server are the first line of defense.

This is dependant on your use case, but the template provided here is just that.

---
#### *Verify you have open-ssh installed.*
* `apt-get ssh` it if not.*
```bash
# Check upstream for `ssh`
apt-cache show ssh

# Check if `ssh` is installed on your host.
if ! command -v ssh; then
    sudo apt install ssh
fi
```
---

## SSH Key Generation
Start by generating an ***id_ed25519 key pair***.

You will be prompted for a few questions.
* If you set a passphrase you will be prompted every time you push/pull upstream.
* This can be left empty if security is not a concern

#### Execute this command filling in your GitHub email after `-C`.
```bash
man ssh-keygen
ssh-keygen -t id_ed25591 -C 'GITHUB_EMAIL@EMAIL.com'
```

#### Two files should have been created in *~/.ssh/*
* *id_ed22519* - PRIVATE KEY. Keep this secure.
* *id_ed25519.pub* - PUBLIC KEY. Upload this to GitHub.
```bash
# PRIVATE KEY
>>> cat ~/.ssh/config/id_ed25519
---BEGIN OPENSSH PRIVATE KEY---
<LONG-RANDOM-ALNUM-STRING>
----END OPENSSH PRIVATE KEY----
```
```bash
# PUBLIC KEY
>>> cat ~/.ssh/config/id_ed25519.pub
ssh-ed25519 <SHA-STRING> GITHUB_EMAIL@EMAIL.com 
```

---
## ~/.ssh/config template
**These man pages and the OpenSSH docs should answer most configuration questions.**
```bash
# SSH Manual
man ssh

# SSH Client config (outgoing)
man ssh_config

# SSH Server config (incoming)
man sshd_config
```

**The `~/.ssh/config` file *will not* be generated by default.**
* You will need to create it with a command like `touch ~/.ssh/config` and copy this into it.
* If it does exist just append the `Host gh` record at the end. 

**Setting `ControlMaster`, `ControlPath`, `ControlPersist` will reuse the SSH connection.**
* If you have slower internet or work alot with upstreams this may help speed it up.

```txt
Host *
    ForwardAgent no
    ForwardX11 no
    ForwardX11Trusted yes
    Port 22
    Protocol 2
    VisualHostKey yes
    PreferredAuthentications publickey
    PasswordAuthentication yes
    LogLevel INFO

# Test w/ `ssh -T gh`
Host gh
    Hostname github.com
    User git
    IdentityFile ~/.ssh/id_ed25519
    # Reuse connection, persist( 1h ).
    # ControlMaster auto
    # ControlPath ~/.ssh/master-%r@%h:%p.socket
    # ControlPersist 1h
```

---
## Switch existing remotes from HTTPS to SSH
Remote URL formats:
* `https://github.com/GIT_USER/GIT_REPO.git`
* `git@github.com:USERNAME/REPOSITORY.git`

If you cloned a repository with *HTTPS* switch to *SSH* with the following.
```bash
# You must be in a git repo to check its remotes
cd ~/local-git-repo

# Check remote URL's known to ~/local-git-repo
git remote -v

# Change remote URL's like so
git remote set-url origin git@github.com:USERNAME/REPOSITORY.git

# Recheck remote URL's
git remote -v
```

## SSH-Agent
```bash
# If you create an "~/.ssh/config" file I dont think this is required.

# Start ssh-agent in background
ssh-agent -s
eval "$(ssh-agent -s)"

# Add private key to ssh-agent, (prompts for passphrase if key has one)
ssh-add ~/.ssh/id_ed25591
```
